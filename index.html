<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ECG Monitor</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: -apple-system, BlinkMacSystemFont;
}
header {
  padding: 20px;
  display: flex;
  gap: 40px;
}
.metric span {
  font-size: 14px;
  opacity: 0.6;
}
.metric strong {
  font-size: 28px;
}
canvas {
  display: block;
}
</style>
</head>
<body>

<header>
  <div class="metric"><span>Heart Rate</span><br><strong id="hr">â€”</strong></div>
  <div class="metric"><span>Status</span><br><strong>Live</strong></div>
</header>

<canvas id="ecg"></canvas>

<script>
const canvas = document.getElementById("ecg");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 100;

let dataBuf = [];

const ws = new WebSocket("wss://ecg-cloud-production.up.railway.app");

ws.onmessage = e => {
  const d = JSON.parse(e.data);
  if (typeof d.ecg === "number") {
    dataBuf.push(d.ecg);
    if (dataBuf.length > canvas.width) dataBuf.shift();
  }
  if (d.HR) document.getElementById("hr").innerText = d.HR + " bpm";
};

function draw() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = "#00ffa2";
  ctx.lineWidth = 1.5;
  ctx.beginPath();

  dataBuf.forEach((v, i) => {
    const y = canvas.height / 2 - v * 0.5;
    i === 0 ? ctx.moveTo(0, y) : ctx.lineTo(i, y);
  });

  ctx.stroke();
  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
